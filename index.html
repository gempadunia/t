<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info Gempa Bumi</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- LeafletJS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Moment.js for robust date/time handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/locale/id.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
        }
        #map { height: 400px; }
        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .form-input {
            @apply mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500;
        }
        .quake-row:hover {
            background-color: #f0f9ff;
            cursor: pointer;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- PAGE 1: Manual Input and BMKG List -->
    <div id="page1" class="w-full max-w-4xl mx-auto space-y-8">
        <!-- Manual Input Section -->
        <div class="bg-white p-6 sm:p-8 rounded-2xl border border-gray-200">
            <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">Input Gempa Manual (CSV)</h1>
            <form id="manualGempaForm" class="space-y-4">
                <div>
                    <label for="csvData" class="form-label">Data Gempa</label>
                    <textarea id="csvData" name="csvData" rows="3" class="form-input" placeholder="mag,kedalaman,waktu,lat,long,lokasi&#10;5.4,10.0,2024-09-24T12:54:00Z,-7.5,110.5,&quot;135 km BaratDaya Semarang&quot;"></textarea>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="manual_tsunami" class="form-label">Potensi Tsunami</label>
                        <select id="manual_tsunami" name="tsunami" class="form-input">
                            <option>Tidak Berpotensi Tsunami</option>
                            <option>BERPOTENSI TSUNAMI</option>
                        </select>
                    </div>
                    <div>
                        <label for="manual_guncangan" class="form-label">Guncangan (MMI)</label>
                        <select id="manual_guncangan" name="guncangan" class="form-input">
                            <option>I</option> <option>II-III</option> <option>IV</option>
                            <option>V</option> <option>VI</option> <option>VII</option>
                            <option>VIII</option> <option>IX</option> <option>X+</option>
                        </select>
                    </div>
                </div>
                <div class="pt-2">
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105">
                        Submit Gempa Manual
                    </button>
                </div>
            </form>
        </div>

        <!-- BMKG Live Data Section -->
        <div class="bg-white p-6 sm:p-8 rounded-2xl border border-gray-200">
            <h1 class="text-2xl font-bold text-center text-gray-800 mb-2">Gempa Bumi Terkini (BMKG)</h1>
            <p class="text-center text-gray-500 mb-6">Klik salah satu gempa untuk memvisualisasikan.</p>
            
            <div id="loading" class="text-center py-8">
                <p class="text-lg text-gray-600">Memuat data gempa...</p>
            </div>
            
            <div id="quake-table-container" class="hidden overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Magnitudo</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/2">Wilayah/Waktu (UTC)</th>
                            <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Kedalaman</th>
                            <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">MT</th>
                        </tr>
                    </thead>
                    <tbody id="quake-table-body" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- MODAL FOR BMKG DATA -->
    <div id="modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-8 rounded-2xl w-full max-w-md">
            <h2 class="text-xl font-bold text-center mb-4">Informasi Tambahan</h2>
            <p id="modal-quake-info" class="text-center text-gray-600 mb-6"></p>
            <form id="modalForm" class="space-y-4">
                <input type="hidden" id="modal-data-storage">
                <div>
                    <label for="manual-time" class="form-label">Waktu WIB Manual (HH:MM:SS)</label>
                    <input type="text" id="manual-time" name="manual_time" class="form-input" placeholder="16:00:00">
                </div>
                 <div>
                    <label for="tsunami" class="form-label">Potensi Tsunami</label>
                    <select id="tsunami" name="tsunami" class="form-input">
                        <option>Tidak Berpotensi Tsunami</option>
                        <option>BERPOTENSI TSUNAMI</option>
                    </select>
                </div>
                 <div>
                    <label for="guncangan" class="form-label">Guncangan (MMI)</label>
                    <select id="guncangan" name="guncangan" class="form-input">
                        <option>I</option> <option>II-III</option> <option>IV</option> <option>V</option>
                        <option>VI</option> <option>VII</option> <option>VIII</option> <option>IX</option>
                        <option>X+</option>
                    </select>
                </div>
                <div class="pt-4 flex gap-4">
                    <button type="button" id="cancel-btn" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-4 rounded-lg">Batal</button>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg">Submit</button>
                </div>
            </form>
        </div>
    </div>


    <!-- PAGE 2: DISPLAY INFO -->
    <div id="page2" class="hidden w-full md:max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden">
            <div id="report-container" class="bg-white p-4 sm:p-6" style="position: relative;">
                <header class="text-center mb-4">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Informasi Gempa Terkini</h2>
                    <p class="text-sm sm:text-base text-gray-500">@gempa.dunia</p>
                </header>
                
                <div id="map" class="w-full rounded-lg border border-gray-200 shadow-inner"></div>

                <div class="grid grid-cols-1 md:grid-cols-[1fr_2fr] gap-4 mt-4">
                    <div id="magnitude-container" class="md-col-span-1 text-white rounded-xl flex flex-col items-center justify-center p-4 text-center">
                        <h3 class="font-bold text-lg uppercase tracking-wider">Magnitudo</h3>
                        <p id="display-magnitude" class="text-[90px] font-black leading-none">2.1</p>
                    </div>
                    
                    <div class="space-y-4 bg-gray-50 p-4 rounded-xl border border-gray-200">
                        <div class="grid grid-cols-1 sm:grid-cols-[minmax(0,_3fr)_minmax(0,_2fr)] gap-x-4 gap-y-6">
                            <div class="flex items-start space-x-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 mt-1 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                <div>
                                    <h4 class="font-bold text-gray-800">Waktu</h4>
                                    <p id="display-waktu" class="text-gray-600"></p>
                                </div>
                            </div>
                             <div class="flex items-start space-x-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 mt-1 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 12.343l-3.535 3.536m-2.829-2.829l-3.535 3.536m-2.121-2.121L3 17.25m18-10.5L3 6.75m18 0l-3.535 3.536" /></svg>
                                <div>
                                    <h4 class="font-bold text-gray-800">Kedalaman</h4>
                                    <p id="display-kedalaman" class="text-gray-600"></p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 mt-1 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                <div>
                                    <h4 class="font-bold text-gray-800">Lokasi</h4>
                                    <p id="display-koordinat" class="text-gray-600"></p>
                                    <p id="display-detailLokasi" class="text-gray-600 font-semibold"></p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                               <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500 mt-1 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                                <div>
                                    <h4 class="font-bold text-gray-800">Estimasi Guncangan</h4>
                                    <p id="display-guncangan" class="text-gray-600 font-semibold"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <p id="display-tsunami" class="w-full font-bold text-3xl p-3 rounded-lg text-center"></p>
                </div>
            </div>
        </div>
        
        <div class="mt-6 w-full md:max-w-2xl mx-auto">
            <div class="bg-white p-4 rounded-xl border border-gray-200">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-lg text-gray-800">Narasi Gempabumi</h3>
                    <button id="salin-btn" class="bg-blue-500 hover:bg-blue-600 text-white text-sm font-bold py-1 px-3 rounded-lg transition-colors">
                        Salin Narasi
                    </button>
                </div>
                <pre id="narasi-gempa" class="whitespace-pre-wrap text-sm text-gray-700 font-sans bg-gray-50 p-3 rounded"></pre>
            </div>

            <div class="mt-6 flex justify-center">
                <button id="back-btn" class="w-full sm:w-auto bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform hover:scale-105">
                    Kembali ke Form
                </button>
            </div>
        </div>
    </div>

    <script>
        window.addEventListener('load', () => {
            moment.locale('id');

            const page1 = document.getElementById('page1');
            const page2 = document.getElementById('page2');
            const modal = document.getElementById('modal');
            const modalForm = document.getElementById('modalForm');
            const manualGempaForm = document.getElementById('manualGempaForm');
            const cancelBtn = document.getElementById('cancel-btn');
            const backBtn = document.getElementById('back-btn');
            const salinBtn = document.getElementById('salin-btn');
            const narasiDisplay = document.getElementById('narasi-gempa');
            
            const map = L.map('map', { zoomControl: false }).setView([-2.548926, 118.0148634], 5);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: 'Â© OpenStreetMap'
            }).addTo(map);

            const epicenterIconSVG = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="32" height="32">
                    <circle cx="50" cy="50" r="45" fill="#ff0000" stroke="#fff" stroke-width="5"/>
                    <path d="M25,50 h10 l5,-15 l10,30 l10,-30 l5,15 h10" fill="none" stroke="#fff" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>`;
            
            const epicenterIcon = L.divIcon({
                html: epicenterIconSVG,
                className: '',
                iconSize: [32, 32],
                iconAnchor: [16, 16]
            });

            let marker = L.marker([0, 0], { icon: epicenterIcon }).addTo(map);
            let circles = [
                L.circle([0, 0], { radius: 0, color: '#ff0000', weight: 1, fillColor: '#f03', fillOpacity: 0.3 }),
                L.circle([0, 0], { radius: 0, color: '#ff0000', weight: 1, fillColor: '#f03', fillOpacity: 0.2 }),
                L.circle([0, 0], { radius: 0, color: '#ff0000', weight: 1, fillColor: '#f03', fillOpacity: 0.1 })
            ];
            circles.forEach(c => c.addTo(map));

            const guncanganColors = {
                'I':      { bg: '#ffffff', text: 'text-black' },
                'II-III': { bg: '#8fdaff', text: 'text-black' },
                'IV':     { bg: '#57f7ff', text: 'text-black' },
                'V':      { bg: '#95ffa3', text: 'text-black' },
                'VI':     { bg: '#fceb05', text: 'text-black' },
                'VII':    { bg: '#ffb401', text: 'text-white' },
                'VIII':   { bg: '#ff6f01', text: 'text-white' },
                'IX':     { bg: '#ff0109', text: 'text-white' },
                'X+':     { bg: '#ba0000', text: 'text-white' },
            };
            
            async function fetchBMKGData() {
                const loadingDiv = document.getElementById('loading');
                const tableContainer = document.getElementById('quake-table-container');
                const tableBody = document.getElementById('quake-table-body');
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const apiUrl = 'https://bmkg-content-inatews.storage.googleapis.com/live30event.xml';

                try {
                    const response = await fetch(proxyUrl + encodeURIComponent(apiUrl));
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const xmlText = await response.text();
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlText, "application/xml");
                    const events = xmlDoc.getElementsByTagName("gempa"); 

                    tableBody.innerHTML = ''; 
                    for (let i = 0; i < events.length; i++) {
                        const event = events[i];
                        const eventid = event.getElementsByTagName("eventid")[0].textContent;
                        const mag = event.getElementsByTagName("mag")[0].textContent;
                        const depth = event.getElementsByTagName("dalam")[0].textContent;
                        const timeUTC = event.getElementsByTagName("waktu")[0].textContent;
                        const lat = event.getElementsByTagName("lintang")[0].textContent;
                        const lon = event.getElementsByTagName("bujur")[0].textContent;
                        const area = event.getElementsByTagName("area")[0].textContent;
                        const status = event.getElementsByTagName("status")[0].textContent;
                        const fokal = event.getElementsByTagName("fokal")[0].textContent;
                        
                        let mtCell = '<td>-</td>';
                        if (fokal === 'mt_yes') {
                            mtCell = `<td><img width='40' src='https://bmkg-content-inatews.storage.googleapis.com/mt.${eventid}.png'></td>`;
                        }

                        const row = document.createElement('tr');
                        row.className = 'quake-row align-middle';
                        row.innerHTML = `
                            <td class="px-4 py-4 text-center"><h5 class="text-red-600 font-bold text-lg">M${mag}</h5></td>
                            <td class="px-6 py-4">
                                <div>${area}</div>
                                <div class="text-gray-500 text-sm">${timeUTC} <i class="text-gray-400">(${status})</i></div>
                            </td>
                            <td class="px-4 py-4 text-center">${depth} Km</td>
                            <td class="px-4 py-4 text-center">${mtCell.replace(/<\/?td>/g, '')}</td>
                        `;
                        
                        const quakeData = {
                            magnitude: parseFloat(mag),
                            kedalaman: parseFloat(depth),
                            waktu: timeUTC, // Keep original UTC string
                            lat: parseFloat(lat),
                            lng: parseFloat(lon),
                            detailLokasi: area,
                        };
                        row.dataset.quakeInfo = JSON.stringify(quakeData);

                        row.addEventListener('click', () => {
                            document.getElementById('modal-quake-info').textContent = `M${quakeData.magnitude} di ${quakeData.detailLokasi}`;
                            document.getElementById('modal-data-storage').value = row.dataset.quakeInfo;
                            modal.classList.remove('hidden');
                        });
                        
                        tableBody.appendChild(row);
                    }
                    loadingDiv.classList.add('hidden');
                    tableContainer.classList.remove('hidden');
                } catch (error) {
                    loadingDiv.innerHTML = `<p class="text-red-500">Gagal memuat data gempa. Silakan coba lagi nanti.</p>`;
                    console.error("Error fetching BMKG data:", error);
                }
            }

            function formatWaktu(waktu, manualTime) {
                 // Prioritize manual time input
                if (manualTime && manualTime.match(/^\d{2}:\d{2}:\d{2}$/)) {
                    const datePart = moment(waktu).format('DD MMMM YYYY');
                    return `${datePart}<br>${manualTime} WIB`;
                }

                // Fallback to automatic conversion if manual is empty or invalid
                const wibMoment = moment(waktu.replace(/\//g, '-').replace(' ', 'T') + 'Z').add(7, 'hours');
                if (wibMoment.isValid()) {
                    return `${wibMoment.format('DD MMMM YYYY')}<br>${wibMoment.format('HH:mm:ss')} WIB`;
                } else {
                    return "Waktu Tidak Valid";
                }
            }
            
             function formatWaktuNarasi(waktu, manualTime) {
                if (manualTime && manualTime.match(/^\d{2}:\d{2}:\d{2}$/)) {
                     const datePart = moment(waktu).format('DD MMMM YYYY');
                    return `${datePart} ${manualTime} WIB`;
                }
                 const wibMoment = moment(waktu.replace(/\//g, '-').replace(' ', 'T') + 'Z').add(7, 'hours');
                 if (wibMoment.isValid()) {
                    return wibMoment.format('DD MMMM YYYY HH:mm:ss') + ' WIB';
                 } else {
                    return "Waktu Tidak Valid";
                 }
            }


            function getCurrentWIBTime() {
                return moment().utcOffset('+07:00').format('DD/MM/YYYY HH:mm');
            }
            
            function generateNarasi(data) {
                const publishedTime = getCurrentWIBTime();
                const narasi = `M${parseFloat(data.magnitude).toFixed(1)}
[PARAMETER AWAL]

Kedalaman = ${data.kedalaman} Kilometer
Lokasi = ${data.detailLokasi}
Waktu = ${formatWaktuNarasi(data.waktu, data.manual_time)}
Sumber Gempa = ?
Guncangan Maksimum = ${data.guncangan} MMI
Potensi Tsunami = ${data.tsunami}
Estimasi Korban = ?
Perkiraan Kerugian = ?
Rincian Guncangan Gempa (dalam MMI) = 
Belum Tersedia

Data Oleh ?
Dipublikasikan pada ${publishedTime} WIB`;
                return narasi;
            }

            function getRadiusByMagnitude(mag) {
                if (mag < 1) return [2000, 4000, 10000]; if (mag < 2) return [2000, 4000, 10000]; if (mag < 3) return [3000, 6000, 12000]; if (mag < 4) return [4000, 8000, 14000]; if (mag < 5) return [6000, 12000, 30000]; if (mag < 6) return [10000, 20000, 40000]; if (mag < 7) return [20000, 40000, 80000]; if (mag < 8) return [40000, 80000, 120000]; if (mag < 9) return [100000, 200000, 400000]; return [200000, 400000, 800000];
            }
            
            function displayGempa(data) {
                document.getElementById('display-magnitude').textContent = data.magnitude.toFixed(1);
                document.getElementById('display-kedalaman').textContent = `${data.kedalaman} Km`;
                document.getElementById('display-waktu').innerHTML = formatWaktu(data.waktu, data.manual_time);
                document.getElementById('display-koordinat').textContent = `${Math.abs(data.lat)} ${data.lat >= 0 ? 'LU' : 'LS'}, ${Math.abs(data.lng)} ${data.lng >= 0 ? 'BT' : 'BB'}`;
                document.getElementById('display-detailLokasi').textContent = data.detailLokasi;
                document.getElementById('display-guncangan').textContent = `${data.guncangan} MMI`;
                
                const tsunamiDisplay = document.getElementById('display-tsunami');
                tsunamiDisplay.textContent = data.tsunami;
                tsunamiDisplay.classList.remove('bg-green-700', 'text-white', 'bg-red-800');
                if (data.tsunami === 'BERPOTENSI TSUNAMI') {
                    tsunamiDisplay.classList.add('bg-red-800', 'text-white');
                } else {
                    tsunamiDisplay.classList.add('bg-green-700', 'text-white');
                }

                const magnitudeContainer = document.getElementById('magnitude-container');
                const magTextElements = magnitudeContainer.querySelectorAll('h3, p');
                const colors = guncanganColors[data.guncangan] || { bg: '#cccccc', text: 'text-black' };
                magnitudeContainer.style.backgroundColor = colors.bg;
                magTextElements.forEach(el => {
                    el.classList.remove('text-white', 'text-black');
                    el.classList.add(colors.text);
                });

                narasiDisplay.textContent = generateNarasi(data);

                page1.classList.add('hidden');
                page2.classList.remove('hidden');

                setTimeout(() => {
                    map.invalidateSize();
                    map.setView([data.lat, data.lng], 7);
                    marker.setLatLng([data.lat, data.lng]);
                    const radii = getRadiusByMagnitude(data.magnitude);
                    circles.forEach((circle, index) => {
                        circle.setLatLng([data.lat, data.lng]);
                        circle.setRadius(radii[index]);
                    });
                    
                    let maxRadius = Math.max(...radii);
                    let zoomLevel = 11 - Math.log(maxRadius / 1000) / Math.log(2);
                    map.setView([data.lat, data.lng], Math.max(5, Math.min(13, zoomLevel)));
                }, 200);
            }

            // --- EVENT LISTENERS ---

            // For BMKG data (modal)
            modalForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(modalForm);
                const manualData = Object.fromEntries(formData.entries());
                const storedData = JSON.parse(document.getElementById('modal-data-storage').value);
                const finalData = { ...storedData, ...manualData };
                
                modal.classList.add('hidden');
                displayGempa(finalData);
            });

            // For Manual CSV data
            manualGempaForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(manualGempaForm);
                const rawData = Object.fromEntries(formData.entries());

                const csvLines = rawData.csvData.split('\n');
                const csvData = csvLines[csvLines.length - 1]; 
                const parts = csvData.match(/(?:[^\s,"]+|"[^"]*")+/g);

                if (!parts || parts.length < 6) {
                    alert('Format CSV tidak valid. Pastikan ada 6 kolom: mag,kedalaman,waktu,lat,long,lokasi');
                    return;
                }

                const data = {
                    magnitude: parseFloat(parts[0]),
                    kedalaman: parseFloat(parts[1]),
                    waktu: parts[2], // This should be an ISO 8601 string e.g. "2024-09-24T12:54:00Z"
                    lat: parseFloat(parts[3]),
                    lng: parseFloat(parts[4]),
                    detailLokasi: parts.slice(5).join(',').replace(/"/g, ''), 
                    tsunami: rawData.tsunami,
                    guncangan: rawData.guncangan
                };
                
                displayGempa(data);
            });

            cancelBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
            
            backBtn.addEventListener('click', () => {
                page2.classList.add('hidden');
                page1.classList.remove('hidden');
            });

            salinBtn.addEventListener('click', () => {
                const narasiText = narasiDisplay.textContent;
                const textArea = document.createElement('textarea');
                textArea.value = narasiText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);

                const originalText = salinBtn.textContent;
                salinBtn.textContent = 'Tersalin!';
                salinBtn.disabled = true;
                setTimeout(() => {
                    salinBtn.textContent = originalText;
                    salinBtn.disabled = false;
                }, 2000);
            });
            
            // Fetch the data when the page loads
            fetchBMKGData();
        });
    </script>
</body>
</html>

